<!DOCTYPE HTML>
<html>
<head>
	<title>Physics</title>
	
	<style>
		body {    
			margin: 10;
			padding: 0;
		}
		table, th, td {
		   border: 1px solid black;
		}
		table {
			border-collapse: collapse;
		}
	</style>

</head>

<body style="width:100%;height:100%;overflow-x:hidden;">
	<form>
		Max pos:<br>
		<input type="number" id="maxyin" value="10" style="margin:5px"><br>
		Min pos:<br>
		<input type="number" id="minyin" value="-10" style="margin:5px"><br>
		Max t:<br>
		<input type="number" id="maxtin" value="10" min="0" step=".1" style="margin:5px"><br>
	</form>
	
	<br><br><br>
	
	<form>
		<input type="radio" name="method" value="accelDefined" onclick="setBase('acceleration')" checked>Acceleration based
		<input type="radio" name="method" value="velDefined" onclick="setBase('velocity')">Velocity based
	</form>
	
	<form>
		Start position:<br>
		<input type="number" id="sposin" value="0" style="margin:5px"><br>
	</form>
	
	<form id="accbase">
		Start velocity:<br>
		<input type="number" id="svelin" value="0" style="margin:5px"><br>
		Acceleration (use 'pos' for x position):<br>
		<textarea id="accin" style="margin:5px">-pos</textarea><br>
	</form>
	
	<form id="velbase" style="display:none;">
		Velocity (use 'pos' for x position):<br>
		<textarea id="velin" style="margin:5px">-pos</textarea><br>
	</form>
	
	<form>
		Interval (dt):<br>
		<input type="number" id="interin" value="0.1" min="0" step=".1" style="margin:5px"><br>
		
		<input type="button" onclick="run()" value="Run" style="margin:15px">
	</form>
	
	<canvas id="canvas" width=800 height=400></canvas>
	
	<div style="margin:10px">
		<table>
			<thead>
				<th>t</th>
				<th>pos (x)</th>
				<th>vel (dx/dt)</th>
				<th>acc (dx2/dt2)</th>
			</thead>
			<tbody id="output">
			</tbody>
		</table>
	</div>
</body>

<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<script>
	var base = "acceleration";

	function setBase(newbase){
	
		if(newbase === "acceleration"){
			document.getElementById('accbase').style.display = "block";
			document.getElementById('velbase').style.display = "none";
			
			base = "acceleration";
		}else if(newbase === "velocity"){
			document.getElementById('accbase').style.display = "none";
			document.getElementById('velbase').style.display = "block";
			
			base = "velocity";
		}else{
			console.log("Bad base");
		}
	}
	
	////
	
	var maxyin = document.getElementById('maxyin');
	var minyin = document.getElementById('minyin');
	var maxtin = document.getElementById('maxtin');
	
	var sposin = document.getElementById('sposin');
	var svelin = document.getElementById('svelin');
	var velin = document.getElementById('velin');
	var accin = document.getElementById('accin');
	
	var interin = document.getElementById('interin');
	
	
	var canvas = document.getElementById("canvas");
	var g = canvas.getContext('2d');
	
	////
	
	var maxy;
	var miny;
	var maxt;
	
	var spos;
	var svel;
	var vel;
	var acc;
	
	var inter;
	var curt;
	
	var baseref;
	var accref;
	var velref;
	
	var thread
	
	////
	
	maxy = maxyin.value;
	miny = minyin.value;
	maxt = maxtin.value;
	
	function drawGraph(){
		g.clearRect(0, 0, canvas.offsetWidth, canvas.offsetHeight);
	
		g.strokeStyle = '#000000';
		g.lineWidth = 3;
	
		g.beginPath();
		g.moveTo(conX(0), conY(maxy));
		g.lineTo(conX(0), conY(miny));
		g.stroke();
		
		g.moveTo(0, conY(0));
		g.lineTo(conX(maxt), conY(0));
		g.stroke();
		
		g.lineWidth = 2;
		
		for(var i = 1; i < maxt; i ++){
			g.moveTo(conX(i), conY(0) - 10);
			g.lineTo(conX(i), conY(0) + 10);
			g.stroke();
			
			if(conY(0) + 14 < canvas.offsetHeight){
				g.fillText(i, conX(i) + 4, conY(0) + 12);
			}else{
				g.fillText(i, conX(i) + 4, conY(0) - 6);
			}
		}
		
		for(var i = maxy - 1; i > miny; i --){
			if(i === 0){continue;}
			
			g.moveTo(conX(0) - 10, conY(i));
			g.lineTo(conX(0) + 10, conY(i));
			g.stroke();
			
			g.fillText(i, conX(0) + 12, conY(i) + 4);
		}
		
		g.lineWidth = 3;
	}
	
	function conX(x){
		return 10 + ((x / maxt) * (canvas.offsetWidth - 10));
	}
	
	function conY(y){
		return canvas.offsetHeight * (1 - ((y - miny) / (maxy - miny)));
	}
	
	drawGraph();
	
	////
	
	function run(){
		
		clearInterval(thread);
		$('#output').empty();
		drawGraph();
	
		maxy = maxyin.value;
		miny = minyin.value;
		maxt = maxtin.value;
	
		spos = sposin.value;
		svel = svelin.value;
		vel = velin.value;
		acc = accin.value;
	
		inter = interin.value;
		curt = 0;
		
		baseref = base;
	
		if(baseref === "acceleration"){
		
			accref = acc;
		
			pos = eval(spos);
			vel = eval(svel);
			acc = eval(accref);
			
			g.strokeStyle = '#ff0000';
			g.beginPath();
			g.moveTo(conX(0), conY(pos));
			
			thread = setInterval(tick, 1);
			
		}else if(baseref === "velocity"){
			velref = vel;
		
			pos = eval(spos);
			vel = eval(velref);
			
			g.strokeStyle = '#ff0000';
			g.beginPath();
			g.moveTo(conX(0), conY(pos));
			
			thread = setInterval(tick, 0);
		}
	}
	
	function tick(){
		if(baseref === "acceleration"){
		
			var html = "<tr><td>" + curt.toFixed(4) + "</td><td>" + pos.toFixed(4) + "</td><td>" + vel.toFixed(4) + "</td><td>" + acc.toFixed(4) + "</td></tr>";
			$('#output').append( html );
	
			acc = eval(accref);
			vel += acc * inter;
			pos += vel * inter;
		
			curt += eval(inter);
			
			console.log(curt);
		
			g.lineTo(conX(curt), conY(pos));
			g.stroke();
			
			if(curt > maxt){
				clearInterval(thread);
				console.log("Self terminating");
			}
			
		}else if(baseref === "velocity"){
			var html = "<tr><td>" + curt.toFixed(4) + "</td><td>" + pos.toFixed(4) + "</td><td>" + vel.toFixed(4) + "</td><td>" + "NA" + "</td></tr>";
			$('#output').append( html );
	
			vel = eval(velref);
			pos += vel * inter;
		
			curt += eval(inter);
			
			console.log(curt);
		
			g.lineTo(conX(curt), conY(pos));
			g.stroke();
			
			if(curt > maxt){
				clearInterval(thread);
				console.log("Self terminating");
			}
		}
	}
	
</script>
