<!DOCTYPE HTML>
<html>
<head>
  <title>Dot Stuff</title>
  <style>
    body {    
    margin: 0;
    padding: 0;
	}
	
	table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
	}
  </style>

</head>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js">
  </script>

<body>
	<canvas id="draw" width="1600px" height="900px"></canvas>
</body>

<script>
	var WIDTH = 1400;
	var HEIGHT = 800;
	var FPS = 50;

	function ArrayList(){
		this.array = [];
		this.length = 0;
		
		this.add = function(ob){
			this.array[this.length] = ob;
			this.length ++;
		}
		
		this.index = function(ob){
			return this.array.indexOf(ob);
		}
		
		this.remove = function(ob){
			for(var i = this.array.indexOf(ob); i < this.length - 1; i++){
				this.array[i] = this.array[i + 1];
			}
			
			this.length --;
		}
		
		this.get = function(ind){
			return this.array[ind];
		}
	}
	
	function Point(x, y){
		this.y = y;
		this.x = x;
		
		this.mag = function(){
			return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
		}
		
		this.add = function(p){
			return new Point(this.x + p.x, this.y + p.y);
		}
		
		this.sub = function(p){
			return new Point(this.x - p.x, this.y - p.y);
		}
		
		this.mul = function(s){
			return new Point(this.x * s, this.y * s);
		}
		
		this.scale = function(s){
			return new Point((s / this.mag()) * this.x, (s / this.mag()) * this.y);
		}
		
		this.toString = function(){
			return x + ', ' + y;
		}
		
		this.equals = function(p){
			return (this.x == p.x) && (this.y == p.y);
		}
	}
	
	function Dot(pos){
		this.type = "Dot";
	
		this.pos = pos;
		
		this.tick = function(){
		
		}
		
		this.render = function(g){
			g.fillStyle = "#D0D000";
			g.fillRect(this.pos.x - 4, this.pos.y - 4, 8, 8);
		}
	}
	
	function Player(name, pos, speed, accel, lifespan){
		this.type = "Player";
		this.name = name;
	
		this.pos = pos;
		this.vel = new Point(0, 0);
		this.acc = new Point(0, 0);
		
		this.speed = speed;
		this.accel = accel;
		this.lifespan = lifespan;
		this.life = 0;
		
		this.t = new Point(-1, -1);

		this.score = 0;
		
		this.tick = function(){
		
			if(!this.t.equals(new Point(-1, -1))){
			
				this.acc = ((this.t.sub(this.pos)).mul((this.speed + (this.pos.sub(this.t)).mag() / 100) / (this.t.sub(this.pos)).mag())).sub(this.vel);
			
				if(this.acc.mag() > this.accel){this.acc = this.acc.scale(this.accel)};
			}else{
				this.acc = new Point(0, 0);
			}
			
			this.vel = this.vel.add(this.acc);
			if(this.vel.mag() > 10){this.vel = this.vel.scale(10);}
			
			this.pos = this.pos.add(this.vel);
			if(this.pos.x < -100){this.pos.x = -100};
			if(this.pos.y < -100){this.pos.y = -100};
			if(this.pos.x > WIDTH + 100){this.pos.x = WIDTH + 100};
			if(this.pos.y > HEIGHT + 100){this.pos.y = HEIGHT + 100};
			
			this.life ++;
		}
		
		this.render = function(g){
			g.fillStyle = "#FF0000";
			g.fillRect(this.pos.x - 7.5, this.pos.y - 7.5, 15, 15);
		}
	}
	
	////
	
	var canvas = document.getElementById('draw');
	
	canvas.width = WIDTH;
	canvas.height = HEIGHT;
	
	var g = canvas.getContext('2d');
	
	////
	
	var game = {};
	
	game.ents = new ArrayList();
	
	game.run = function(){
		game.tick();
		game.render(g);
	}
	
	game.tick = function(){
		for (i = 0; i < game.ents.length; i++){
			var cur = game.ents.get(i);
			cur.tick();
			console.log();
			
			if(cur.type == "Player"){
			
				if(cur.life >= cur.lifespan){game.ents.remove(cur)};
				
				var mindis = 10000;
				cur.t = new Point(-1, -1);
			
				for(j = 0; j < game.ents.length; j++){
					var nex = game.ents.get(j);
					
					if(nex.type == "Dot"){
						
						
						if((nex.pos.sub(cur.pos)).mag() < mindis){
							cur.t = nex.pos;
							mindis = nex.pos.sub(cur.pos).mag();
						}
						
						if((nex.pos.sub(cur.pos)).mag() < 12){
							nex.pos = new Point(Math.random() * WIDTH, Math.random() * HEIGHT);
							cur.score ++;
							
							if(cur.score > 2){
								var accel = cur.accel + 0.1 * (Math.pow((2 * Math.random()) - 1, 7));
								var speed = cur.speed + 4 * (Math.pow((2 * Math.random()) - 1, 7));
								var lifespan = cur.lifespan + 25 * (Math.pow((2 * Math.random()) - 1, 7));
								game.ents.add(new Player(cur.name, cur.pos, speed, accel, lifespan));
								console.log("New Player created with accel: " + accel + " Speed: " + speed + " Lifespan: " + lifespan);
								cur.score = 0;
							}
						}
					}
					
					
				}
				
				
			}
		}
	}
	
	game.render = function(g){
		g.fillStyle = "#F0F0F0";
		g.fillRect(0, 0, WIDTH, HEIGHT);
		
		for (i = 0; i < game.ents.length; i++){
			game.ents.get(i).render(g);
		}
	}
	
	////
	var d = new Date();
	
	game.ents.add(new Player("Bill", new Point(100, 100), 4, 0.1, 500));
	game.ents.add(new Dot(new Point(200, 200)));
	game.ents.add(new Dot(new Point(400, 500)));
	game.ents.add(new Dot(new Point(600, 100)));
	game.ents.add(new Dot(new Point(150, 300)));
	
	////
	
	game._intervalId = setInterval(game.run, 1000 / FPS);
	
</script>

</html>