<!DOCTYPE HTML>
<html>
<head>
	<title>Gravity</title>
	
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<style>
		body{
			margin:0;
			border:0;
			padding:0;
			overflow:hidden;
		}
		
		#sidebar{
			margin:0;
			border:0;
			padding:0;
			
			position: fixed;
			
			width: 20%;
			height: 100%;
			min-width: 250px;
			
			right: 0px;
			top: 0px;
			
			text-align: center;
			
			background-color: #80E0FF;
		}
		
		#go{
			margin: 15px;
			
			margin-right: auto;
			margin-left: auto;
			
			display: block;
			
			width: 90%;
			height: 75px;
		}
		
		#addBody{
		
			margin: 30px;
			
			margin-right: auto;
			margin-left: auto;
			
			display: block;
			
			height: 40px;
		}
		
		#traits{
			margin-right: 20px;
			margin-left: 20px;
			border: 0;
			padding: 10px;
		
			background-color: #B0B0B0;
			border-radius: 10px;
		}
		
		.traitholder{
			width: 40%;
			
			margin-top: 0px;
			
			display: inline-block;
		}
		
		.smallInput{
			padding: 0;
			
			width: 80px;
		}
		
		#setTraits{
			margin: 10px;
			
			margin-right: auto;
			margin-left: auto;
			
			display: block;
			
			height: 20px;
		}
		
		#saves{
			margin-top: 10px;
			margin-bottom: 20px;
			margin-left: 20px;
			margin-right: 20px;
			border: 0;
			padding-top: 10px;
			padding-bottom: 10px;
			padding-left: 5px;
			padding-right: 5px;
			
			text-align: center;
			
			border-radius: 10px;
			background-color: #B0B0B0;
		}
		
		.saveButton{
			min-width: 50px;
		
			margin: 10px;
		}
		
		#namefield{
			width: 80px;
		}
		
		
		input::-webkit-outer-spin-button, input::-webkit-inner-spin-button{
			-webkit-appearance: none;
			margin: 0;
		}
	</style>

</head>

<body>

	<canvas id="canvas"></canvas>
	
	<div id="sidebar">
	
		<input type="button" id="go" value="Start Simulation" onclick="go()" style="color: #FF0000; font-weight: bold; font-size: 100%;"></input>
		
		<input type="button" id="addBody" value="Add Body" onclick="addBody()"></input>
		
		Viewscale:
		<input type="number" id="scale" class="smallInput" value="1"></input>
		<br><br><br>
		
		Timescale:
		<input type="number" id="speed" class="smallInput" value="1"></input>
		<br><br>
		
		Ticks per second:
		<input type="number" id="ticks" class="smallInput" value="100"></input>
		<br><br><br>
		
		<div id="traits">
			
			<div class="traitholder">
				Color:<br>
				<input type="text" id="color" class="smallInput"></input>
				<br>
				
				Size:<br>
				<input type="number" id="size" class="smallInput"></input>
				<br>
				
				Mass:<br>
				<input type="number" id="mass" class="smallInput"></input>
				<br>
			</div>
			
			<div class="traitholder">
				Position-x:<br>
				<input type="number" id="posx" class="smallInput"></input>
				<br>
				
				Position-y:<br>
				<input type="number" id="posy" class="smallInput"></input>
				<br>
				
				Velocity-x:<br>
				<input type="number" id="velx" class="smallInput"></input>
				<br>
				
				Velocity-y:<br>
				<input type="number" id="vely" class="smallInput"></input>
				<br>
			</div>
			
		</div>
	
		<input type="button" id="setTraits" value="Set Traits" onclick="setTraits()"></input>
		
		<br>
		<input type="text" id="namefield"></input>
		<input type="button" id="save" value="Save" onclick="save()"></input>
		
		<div id="saves">
			
			<input type="button" class="saveButton" value="Orbit" onclick="load(0)"></input>
				
			<input type="button" class="saveButton" value="Earth 1" onclick="load(1)"></input>
			
			<input type="button" class="saveButton" value="Earth 2" onclick="load(2)"></input>
			
			<input type="button" class="saveButton" value="Earth 3" onclick="load(3)"></input>
			
			<input type="button" class="saveButton" value="Trifecta" onclick="load(4)"></input>
			
			<input type="button" class="saveButton" value="Jupiter" onclick="load(5)"></input>

		</div>
	</div>
	
</body>

<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js"></script>

<script>
	function Point(x, y){
		this.x = x;
		this.y = y;
		
		this.mag = function(){
			return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
		}
		
		this.add = function(p){
			return new Point(this.x + p.x, this.y + p.y);
		}
		
		this.sub = function(p){
			return new Point(this.x - p.x, this.y - p.y);
		}
		
		this.mul = function(s){
			return new Point(this.x * s, this.y * s);
		}
		
		this.scale = function(s){
			return new Point((s / this.mag()) * this.x, (s / this.mag()) * this.y);
		}
		
		this.toString = function(){
			return x + ', ' + y;
		}
		
		this.equals = function(p){
			return (this.x == p.x) && (this.y == p.y);
		}
	}

	function Body(color, size, mass, px, py, vx, vy){
		this.color = color;
		
		this.size = size;
		
		this.mass = mass;
		
		this.pos = new Point(px, py);
		this.vel = new Point(vx, vy);
		this.acc = new Point(0, 0);
		
		this.update = function(){
			this.vel = this.vel.add(this.acc.mul(TICK_LENGTH));
			this.pos = this.pos.add(this.vel.mul(TICK_LENGTH));
		}
		
		this.render = function(){
			drawBody(this.color, this.size, this.pos.x, this.pos.y);
		}
	}

	function Save(){
		this.entities = [];
		this.name = "new save";
		this.selected = -1;
	}
	
	{////

	var canvas = document.getElementById("canvas");
	
	canvas.width = WIDTH = $(window).width() * 0.8;
	canvas.height = HEIGHT = $(window).height();
	
	$(window).resize(function(){
		var noncanvas = $(window).width() * 0.2;
		
		if(noncanvas < 250){noncanvas = 250;}
	
	  	canvas.width = WIDTH = $(window).width() - noncanvas;
		canvas.height = HEIGHT = $(window).height();
	});
	
	var g = canvas.getContext("2d");
	
	}////
	
	var SCALE = 1;
	var SPEED = 1;
	
	var TICKS_PER_SECOND = 100;
	var TICK_LENGTH = SPEED / TICKS_PER_SECOND;
	
	////
	
	go = function(){
		if(!running){
			running = true;
			
			document.getElementById("go").value = "Pause";
			document.getElementById("go").style.color = "#20FF20";
		}else if(running){
			running = false;
			
			document.getElementById("go").value = "Resume";
			document.getElementById("go").style.color = "#FF2020";
		}
	}
	
	////
	
	var ents = [];
	
	var running = false;
	
	run = function(){
	
		SCALE = Number(document.getElementById("scale").value)
		SPEED = Number(document.getElementById("speed").value)
		TICKS_PER_SECOND = Number(document.getElementById("ticks").value)
		TICK_LENGTH = SPEED / TICKS_PER_SECOND;
	
		if(running){
	
			for(var i = 0; i < ents.length; i ++){
				ents[i].acc = new Point(0, 0);
			}
			
			for(var i = 0; i < ents.length; i ++){
				var cur = ents[i];
			
				for(var j = 0; j < ents.length; j ++){
					if(i === j){continue;}
				
					var nex = ents[j];
					
					if(cur.pos.equals(nex.pos)){continue;}
				
					var temp = nex.pos.sub(cur.pos);
					
					var f = (6.67384e-11 * nex.mass) / Math.pow(temp.mag(), 2);
				
					cur.acc = cur.acc.add(temp.scale(f));
				}
			}
			
			for(var i = 0; i < ents.length; i ++){
				ents[i].update();
			}
			
			updateStats();
		}
		
		////
		
		g.fillStyle = "#F0F0F0";
		g.fillRect(0, 0, WIDTH, HEIGHT);
		
		for(var i = 0; i < ents.length; i ++){
			var cur = ents[i];
			cur.render();
			
			if(selectedBody === i){
				g.strokeStyle = "#40B0F0";
				g.lineWidth = 5;
				g.beginPath();
				g.arc((WIDTH / 2) + (cur.pos.x / SCALE), (HEIGHT / 2) - (cur.pos.y / SCALE), (cur.size / 2) / SCALE, 0, Math.PI * 2, true);
				g.stroke();
			}
		}
	}
	
	////
	
	var selectedBody = -1;
	
	canvas.addEventListener("click", onClick);
	
	function onClick(e){
		
		var index = -1;
		
		for(var i = 0; i < ents.length; i ++){
			var cur = ents[i];
			
			var temp = new Point(conx(cur.pos.x), cony(cur.pos.y));
			
			if(temp.sub(new Point(e.clientX, e.clientY)).mag() < cur.size / (2 * SCALE) || temp.sub(new Point(e.clientX, e.clientY)).mag() < 5){
				index = i;
			}
		}
		
		selectedBody = index;
		
		updateStats();
	}
	
	function updateStats(){
		if(selectedBody !== -1){
			var body = ents[selectedBody];
		
			document.getElementById("color").value = body.color;
			
			if(body.size < 10000){
				document.getElementById("size").value = body.size;
			}else{
				document.getElementById("size").value = body.size.toExponential();
			}
			
			if(body.mass < 10000){
				document.getElementById("mass").value = body.mass;
			}else{
				document.getElementById("mass").value = (body.mass).toExponential();
			}
			
			document.getElementById("posx").value = body.pos.x.toFixed(3);
			document.getElementById("posy").value = body.pos.y.toFixed(3);
			document.getElementById("velx").value = body.vel.x.toFixed(3);
			document.getElementById("vely").value = body.vel.y.toFixed(3);
			
		}else{
			document.getElementById("color").value = null;
			document.getElementById("size").value = null;
			document.getElementById("mass").value = null;
			document.getElementById("posx").value = null;
			document.getElementById("posy").value = null;
			document.getElementById("velx").value = null;
			document.getElementById("vely").value = null;
		}
	}
	
	function setTraits(){
		var body = ents[selectedBody];
		
		body.color = document.getElementById("color").value;
		body.size = Number(document.getElementById("size").value);
		body.mass = Number(document.getElementById("mass").value);
		body.pos = new Point(Number(document.getElementById("posx").value), Number(document.getElementById("posy").value));
		body.vel = new Point(Number(document.getElementById("velx").value), Number(document.getElementById("vely").value));
	}
	
	function addBody(){
		ents[ents.length] = new Body("#404040", WIDTH / 20, 1, 0, 0, 0, 0);
		
		selectedBody = ents.length - 1;
		updateStats();
	}
	
	////
	
	var saves = [];
	
	function save(){
		
		var savename = document.getElementById("namefield").value;
		
		for(var i = 0; i < saves.length; i ++){
			if(saves[i].name === savename){
				saves[i].entities = clone(ents);
				saves[i].selected = selectedBody;
				return;
			}
		}
		
		var html = '<input type="button" class="saveButton" value=' + savename + ' onclick="load([' + saves.length + '])"></input>';
		$('#saves').append(html);
		
		var temp = saves.length;
		
		saves[temp] = new Save();
		saves[temp].entities = clone(ents);
		saves[temp].name = savename;
		saves[temp].selected = selectedBody;
	}
	
	function load(index){
		ents = clone(saves[index].entities);
		
		ents.length = saves[index].entities.length;
		
		selectedBody = saves[index].selected;
		updateStats();
		
		savename = document.getElementById("namefield").value = saves[index].name;
	}
	
	function clone(set){
		var ret = [];
	
		for(var i = 0; i < set.length; i ++){
			var body = set[i];
		
			ret[i] = new Body("#404040", WIDTH / 20, 1, 0, 0, 0, 0);
			ret[i].color = body.color;
			ret[i].size = body.size;
			ret[i].mass = body.mass;
			ret[i].pos.x = body.pos.x;
			ret[i].pos.y = body.pos.y;
			ret[i].vel.x = body.vel.x;
			ret[i].vel.y = body.vel.y;
		}
		
		return ret;
	}
	
	////
	
	ents[0] = new Body("#404040", 50, 1, 0, 0, 0, 0);
	
	saves[0] = new Save();
	saves[0].entities = [new Body('#404040', 50, 1e18, 0, 0, 0, 0),
						new Body('#404040', 20, 1000, 400, 0, 0, 300)];
	saves[0].name = "Orbit";
	saves[0].selected = -1;
	
	saves[1] = new Save();
	saves[1].entities = [new Body('#10E0C0', 12742000, 5.972e24, 0, 0, 0, 0),
						new Body('#202020', 100000, 10000, 6571000, 0, 0, 7788)];
	saves[1].name = "Earth 1";
	saves[1].selected = -1;
	
	saves[2] = new Save();
	saves[2].entities = [new Body('#10E0C0', 12742000, 5.972e24, 0, 0, 0, 0),
						new Body('#A0A0B6', 3474800, 7.34767309e22, 384400000, 0, 0, 1023)];
	saves[2].name = "Earth 2";
	saves[2].selected = -1;
	
	saves[3] = new Save();
	saves[3].entities = [new Body('#10E0C0', 12742000, 5.972e24, 0, -6371000, 0, 0),
						new Body('#202020', 10, 10, 0, 50, 0, 0)];
	saves[3].name = "Earth 3";
	saves[3].selected = -1;
	
	saves[4] = new Save();
	saves[4].entities = [new Body('#404040', 40, 1e17, 0, 200, 90, 0),
						new Body('#404040', 40, 1e17, -173.205080757, -100, -45, 77.9422863406),
						new Body('#404040', 40, 1e17, 173.205080757, -100, -45, -77.9422863406)];
	saves[4].name = "Trifecta";
	saves[4].selected = -1;
	
	saves[5] = new Save();
	saves[5].entities = [new Body('#D09040', 139822000, 1.898e27, 0, 0, 0, 0),
						new Body('#E0C060', 3160000, 4.799844e22, 670900000, 0, 0, 13740),
						new Body('#D0D080', 3636000, 8.931938e22, 421700000, 0, 0, 17334),
						new Body('#787060', 5268000, 1.4819e23, 1070400000, 0, 0, 10880)];
	saves[5].name = "Jupiter";
	saves[5].selected = -1;
	
	//ents[0] = new Body("#F0F010", 1391684000, 1.989e30, 0, 0, 0, 0);
	//ents[1] = new Body("#10E0C0", 12742000, 5.972e24, 149600000000, 0, 0, 29780);
	//ents[2] = new Body("#202020", 3474800, 7.34767309e22, 149984000000, 0, 0, 30803);
	
	//ents[0] = new Body("#10E0C0", 12742000, 5.972e24, 0, 0, 0, 0);
	//ents[1] = new Body("#202020", 3474800, 7.34767309e22, 384000000, 0, 0, 1023);
	
	//ents[0] = new Body("#10E0C0", 300, 1, 0, 0, 0, 0);
	//ents[1] = new Body("#505050", 150, 1, 150, 100, 0, 0);
	//ents[2] = new Body("#E01010", 50, 1, 200, -100, 0, 0);
	
	////
	
	addBody();
	
	var mainthread = setInterval(run, 1000 / (TICKS_PER_SECOND));
	
	////
	
	drawBody = function(color, size, x, y){
		if(size / SCALE < 5){size = 5 * SCALE;}
	
		g.fillStyle = color;
		g.beginPath();
		g.arc(conx(x), cony(y), (size / 2) / SCALE, 0, Math.PI * 2, true);
		g.fill();
	}
	
	conx = function(x){
		return (WIDTH / 2) + (x / SCALE);
	}
	
	cony = function(y){
		return (HEIGHT / 2) - (y / SCALE);
	}
</script>

</html>